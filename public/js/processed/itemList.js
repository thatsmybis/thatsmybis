function _createForOfIteratorHelper(a,t){var r="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!r){if(Array.isArray(a)||(r=_unsupportedIterableToArray(a))||t&&a&&"number"==typeof a.length){r&&(a=r);var i=0,c=function F(){};return{s:c,n:function n(){return i>=a.length?{done:!0}:{done:!1,value:a[i++]}},e:function e(a){throw a},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=!0,o=!1,d;return{s:function s(){r=r.call(a)},n:function n(){var a=r.next();return l=a.done,a},e:function e(a){o=!0,d=a},f:function f(){try{l||null==r.return||r.return()}finally{if(o)throw d}}}}function _unsupportedIterableToArray(a,t){if(a){if("string"==typeof a)return _arrayLikeToArray(a,t);var e=Object.prototype.toString.call(a).slice(8,-1);return"Object"===e&&a.constructor&&(e=a.constructor.name),"Map"===e||"Set"===e?Array.from(a):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?_arrayLikeToArray(a,t):void 0}}function _arrayLikeToArray(a,t){(null==t||t>a.length)&&(t=a.length);for(var e=0,n=new Array(t);e<t;e++)n[e]=a[e];return n}var table=null,colSource=0,colName=1,colPrios=2,colWishlist=3,colReceived=4,colNotes=5,colPriority=6,lastSource=null,offspecVisible=!0,itemListHandlersTimeout=null,raidGroupMap={},guildCharactersMap={};function createTable(){return itemTable=$("#itemTable").DataTable({autoWidth:!1,data:items,oLanguage:{sSearch:"<abbr title='Fuzzy searching is ON. To search exact text, wrap your search in \"quotes\"'>Search</abbr>"},columns:[{title:'<span class="fas fa-fw fa-skull-crossbones"></span> '.concat(headerBoss),data:"",render:function render(a,t,e){return'\n                    <ul class="no-bullet no-indent mb-0">\n                        '.concat(e.source_name?'\n                            <li>\n                                <span class="font-weight-bold">\n                                    '.concat(e.source_name,"\n                                </span>\n                            </li>"):"","\n                    </ul>")},visible:!0,width:"130px",className:"text-right width-130"},{title:'<span class="fas fa-fw fa-sack text-success"></span> '.concat(headerLoot,' <span class="text-muted small">(').concat(items.length,")</span>"),data:"",render:function render(a,t,e){return getItemLink(e)},visible:!0,width:"330px",className:"width-330"},{title:'<span class="fas fa-fw fa-sort-amount-down text-gold"></span> '.concat(headerPrios),data:"priod_characters",render:function render(a,t,e){return a&&a.length?createCharacterListHtml(a,"prio",e.item_id,null):"—"},orderable:!1,visible:!!showPrios,width:"300px",className:"width-300"},{title:'<span class="text-legendary fas fa-fw fa-scroll-old"></span> '.concat(headerWishlist),data:"wishlist_characters",render:function render(a,t,e){if(a&&a.length){var n="";if(currentWishlistNumber){var r=a.filter(function(a){return a.pivot.list_number==currentWishlistNumber});r.length&&(n=createCharacterListHtml(r,"wishlist",e.item_id,null))}else for(i=1;i<=maxWishlistLists;i++){var c=a.filter(function(a){return a.pivot.list_number==i});if(c.length){var s=null;s=wishlistNames&&wishlistNames[i-1]?wishlistNames[i-1]:headerWishlist+" "+i,n+=createCharacterListHtml(c,"wishlist",e.item_id,s)}}return""==n&&(n="—"),n}return"—"},orderable:!1,visible:!!showWishlist,width:"400px",className:"width-400"},{title:'<span class="text-success fas fa-fw fa-sack"></span> '.concat(headerReceived),data:"received_and_recipe_characters",render:function render(a,t,e){return a&&a.length?createCharacterListHtml(a,"received",e.item_id,null):"—"},orderable:!1,visible:!0,width:"300px",className:"width-300"},{title:'<span class="fas fa-fw fa-comment-alt-lines"></span> '.concat(headerNotes),data:"guild_note",render:function render(a,t,e){return getNotes(e,a)},orderable:!1,visible:!!showNotes,width:"200px",className:"width-200"},{title:'<span class="fas fa-fw fa-comment-alt-lines"></span> '.concat(headerPrioNotes),data:"guild_priority",render:function render(a,t,e){return a?'<span class="js-preview-text js-markdown-inline">'.concat(DOMPurify.sanitize(nl2br(a.substring(0,200))),"</span>\n                    ").concat(a.length>200?'<span class="js-full-text js-markdown-inline" style="display:none;">'.concat(DOMPurify.sanitize(nl2br(a)),'</span>\n                        <span class="js-show-text text-link cursor-pointer">show more…</span>\n                        <span class="js-hide-text text-link cursor-pointer" style="display:none;">show less…</span>'):""):"—"},orderable:!1,visible:!!showNotes,width:"200px",className:"width-200"}],order:[],paging:!1,fixedHeader:{headerOffset:43},drawCallback:function drawCallback(){callItemListHandlers()},initComplete:function initComplete(){callItemListHandlers()},createdRow:function createdRow(a,t,e){0!=e&&null!=lastSource||(lastSource=t.source_name),t.source_name!=lastSource&&($(a).addClass("top-border padded-anchor"),$(a).attr("id",t.source_slug?t.source_slug.trim():null),lastSource=t.source_name)}}),itemTable}function addWishlistFilterHandlers(){$("#wishlist_filter").on("change",function(){currentWishlistNumber=$(this).val(),itemTable.rows().invalidate().draw()}).change()}function createCharacterListHtml(a,t,e){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=[];r.push('<ul class="list-inline js-item-list mb-0" data-type="'.concat(t,'" data-id="').concat(e,'">')),n&&r.push('<li class="js-item-wishlist-character no-bullet font-weight-bold text-muted small">'.concat(n,"</li>"));for(var i=4,c=null,s=0;s<a.length;s++){character=a[s];var l=null;if(guild.is_attendance_hidden||(l=guildCharactersMap[character.id]),"prio"==t&&character.pivot.raid_group_id&&character.pivot.raid_group_id!=c){var o;c=character.pivot.raid_group_id;var d=(null===(o=raidGroupMap[character.pivot.raid_group_id])||void 0===o?void 0:o.name)||"";r.push('<li data-raid-group-id="" class="js-item-wishlist-character no-bullet font-weight-normal text-muted small">'.concat(d,"</li>"))}if("wishlist"==t&&(character.raid_group_id&&character.raid_group_id!=c||!character.raid_group_id&&c)){var u="";if(!character.raid_group_id&&c)u="no raid group",c=null;else if(c=character.raid_group_id,raidGroups.length)var h,p=null===(h=raidGroupMap[character.raid_group_id])||void 0===h?void 0:h.name;r.push('<li data-raid-group-id="" class="js-item-wishlist-character no-bullet font-weight-normal text-muted small">'.concat(u,"</li>"))}r.push('<li data-raid-group-id="'.concat("prio"==t?character.pivot.raid_group_id:character.raid_group_id,'"\ndata-offspec="').concat(character.pivot.is_offspec?1:0,'"\nvalue="').concat("prio"==t?character.pivot.order:"",'"\nclass="js-item-wishlist-character list-inline-item font-weight-normal mb-1 mr-0 ').concat("received"!=character.pivot.type&&character.pivot.received_at?"font-strikethrough":"",'">\n<span class="tag text-muted d-inline">\n  <a href="/').concat(guild.id,"/").concat(guild.slug,"/c/").concat(character.id,"/").concat(character.slug,'"\n    title="').concat(character.raid_group_name?character.raid_group_name+" -":""," ").concat(character.level?character.level:""," ").concat(character.race?character.race:""," ").concat(character.spec?character.spec:""," ").concat(character.class?character.class:""," ").concat(character.raid_count?"(".concat(character.raid_count," raid").concat(character.raid_count>1?"s":""," attended)"):""," ").concat(character.username?"("+character.username+")":"",'"\n    class="text-muted">\n    <span class="">').concat("received"!==t&&character.pivot.order?character.pivot.order:"",'</span>\n    <span class="small font-weight-bold">').concat(character.pivot.is_offspec?"OS":"",'</span>\n    <span class="role-circle" style="background-color:').concat(getColorFromDec(character.raid_group_color),'"></span>\n    <span class="text-').concat(character.class?slug(character.class):"",'-important">').concat(character.name,"</span>\n    ").concat(character.is_alt?'\n        <span class="text-warning">'.concat(localeAlt,"</span>\n    "):"","\n    ").concat("received"!==t&&l&&(l.attendance_percentage||l.raid_count)?"".concat(l.raid_count&&"number"==typeof l.attendance_percentage?'<span title="attendance" class="smaller '.concat(getAttendanceColor(l.attendance_percentage),'">').concat(Math.round(100*l.attendance_percentage),"%</span>"):"").concat(l.raid_count?'<span class="smaller"> '.concat(l.raid_count,"r</span>"):"","\n    "):"",'\n  </a>\n  <span class="js-watchable-timestamp js-timestamp-title smaller"\n    data-timestamp="').concat(character.pivot.created_at,'"\n    data-is-short="1">\n  </span>\n  <span style="display:none;">').concat(character.discord_username," ").concat(character.username,"</span>\n  ").concat(character.pivot.note?'<span class="smaller text-muted text-underline" title="'.concat(character.pivot.note,'">note</span>'):"","\n</span>\n</li>"))}return r.push("</ul>"),r.join("")}function getNotes(a,t){var e=null,n="guild_officer_note"in a?a.guild_officer_note:null;return t=t||n?"".concat(t?'<span class="js-preview-text js-markdown-inline">'.concat(DOMPurify.sanitize(nl2br(t.substring(0,200))),"</span>\n                ").concat(t.length>200?'<span class="js-full-text js-markdown-inline" style="display:none;">'.concat(DOMPurify.sanitize(nl2br(t)),'</span>\n                    <span class="js-show-text text-link cursor-pointer">show more…</span>\n                    <span class="js-hide-text text-link cursor-pointer" style="display:none;">show less…</span>'):""):"","\n            ").concat(n&&t?"<br>":"","\n            ").concat(n?'<small class="font-weight-bold font-italic text-gold">Officer\'s Note</small><br>\n            <span class="js-preview-text js-markdown-inline">'.concat(DOMPurify.sanitize(nl2br(n.substring(0,200))),"</span>\n            ").concat(n.length>200?'<span class="js-full-text js-markdown-inline" style="display:none;">'.concat(DOMPurify.sanitize(nl2br(n)),'</span>\n                <span class="js-show-text text-link cursor-pointer">show more…</span>\n                <span class="js-hide-text text-link cursor-pointer" style="display:none;">show less…</span>'):""):"","\n            ").concat(""):"—"}function getItemLink(a){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e="https://".concat(wowheadLocale+wowheadSubdomain,".wowhead.com/item=").concat(a.item_id),n='data-wowhead-link="'.concat(e,'" data-wowhead="item=').concat(a.item_id,"?domain=").concat(wowheadLocale+wowheadSubdomain,'"');t&&(n+=' data-wh-icon-size="'.concat(t,'"'));var r=guild&&!$.isEmptyObject(guild),i="";r?i="/".concat(guild.id,"/").concat(guild.slug,"/i/").concat(a.item_id,"/").concat(slug(a.name)):(console.log("no guild"),i=e);var c="";!a.faction||guild&&guild.faction||("h"===a.faction?c='<span class="text-horde font-weight-bold" title="Horde">H</span>':"a"===a.faction&&(c='<span class="text-alliance font-weight-bold" title="Alliance">A</span>'));var s="";return a.is_heroic&&(s='<span class="text-uncommon small" title="Heroic">Heroic</span>'),'\n    <ul class="no-bullet no-indent mb-0">\n        <li>\n            '.concat(guild.tier_mode?'<span class="text-monospace font-weight-medium text-tier-'.concat(a.guild_tier?a.guild_tier:"",'">').concat(a.guild_tier?getItemTierLabel(a,guild.tier_mode):"&nbsp;","</span>"):"",'\n            <a href="').concat(i,'"\n                target="').concat(r?"":"_blank",'"\n                class="').concat(a.quality?"q"+a.quality:"",'"\n                ').concat(n,">\n                ").concat(a.name,"\n            </a>\n            ").concat(s,"\n            ").concat(c,"\n        </li>\n    </ul>")}function hideOffspecItems(){$("[data-offspec='1']").hide()}function callItemListHandlers(){itemListHandlersTimeout&&clearTimeout(itemListHandlersTimeout),itemListHandlersTimeout=setTimeout(function(){makeWowheadLinks(),parseMarkdown(),trackTimestamps(),addTooltips()},500)}function showOffspecItems(){$("[data-offspec='1']").show()}$(document).ready(function(){if(raidGroups.length){var a=_createForOfIteratorHelper(raidGroups),t;try{for(a.s();!(t=a.n()).done;){var e=t.value;raidGroupMap[e.id]=e}}catch(t){a.e(t)}finally{a.f()}}if(!guild.is_attendance_hidden){var n=_createForOfIteratorHelper(guildCharacters),r;try{for(n.s();!(r=n.n()).done;){var i=r.value;guildCharactersMap[i.id]=i}}catch(a){n.e(a)}finally{n.f()}}table=createTable(),$(".toggle-column").click(function(a){a.preventDefault();var t=table.column($(this).attr("data-column"));t.visible(!t.visible())}),$(".toggle-column-default").click(function(a){a.preventDefault(),table.column(colName).visible(!0),table.column(colPrios).visible(!0),table.column(colWishlist).visible(!0),table.column(colReceived).visible(!0),table.column(colNotes).visible(!0),table.column(colPriority).visible(!0)}),table.on("column-visibility.dt",function(a,t,e,n){callItemListHandlers()}),$("#raid_group_filter").on("change",function(){var a=$(this).val();a?($(".js-item-wishlist-character[data-raid-group-id!='"+a+"']").hide(),$(".js-item-wishlist-character[data-raid-group-id='"+a+"']").show()):$(".js-item-wishlist-character").show()}).change(),$(".js-hide-offspec-items").click(function(){offspecVisible?(offspecVisible=!1,hideOffspecItems()):(offspecVisible=!0,showOffspecItems())}),addWishlistFilterHandlers(),$(".loadingBarContainer").removeClass("d-flex").hide(),$("#itemDatatable").show(),callItemListHandlers()});
