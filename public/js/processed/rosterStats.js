function _readOnlyError(e){throw new Error('"'+e+'" is read-only')}var table=null,view="slots",colCharacter=0,colArchetype=1,colAttendance=2,colMainRaidGroup=3,colNotes=4,colClass=5,colSlotHead=10,colSlotNeck=11,colSlotShoulder=12,colSlotBack=13,colSlotChest=14,colSlotWrists=15,colSlotHands=16,colSlotWaist=17,colSlotLegs=18,colSlotFeet=19,colSlotFinger=20,colSlotTrinket=21,colSlotWeapon=22,colSlotOffhand=23,colSlotRanged=24,colSlotOther=25,allItemsVisible=!1,offspecVisible=!0,rosterHandlersTimeout=null;function createRosterStatsTable(){$.fn.DataTable.isDataTable("#characterStatsTable")&&$("#characterStatsTable").destroy();var e=[{title:'<span class="fas fa-fw fa-user"></span> '.concat(headerCharacter,' <span class="text-muted small">(').concat(characters.length,")</span>"),data:"character",render:function render(e,t,a){return'<ul class="no-bullet no-indent">\n                    <li>\n                        <div class="dropdown text-'.concat(a.class?a.class.toLowerCase():"",'">\n                            <a class="dropdown-toggle font-weight-bold text-').concat(a.class?a.class.toLowerCase():"",'"\n                                id="character').concat(a.id,'Dropdown"\n                                role="button"\n                                data-toggle="dropdown"\n                                aria-haspopup="true"\n                                aria-expanded="false"\n                                title="').concat(a.username?a.username:"",'">\n                                ').concat(a.name,'\n                            </a>\n                            <div class="dropdown-menu" aria-labelledby="character').concat(a.id,'Dropdown">\n                                <a class="dropdown-item" href="/').concat(guild.id,"/").concat(guild.slug,"/c/").concat(a.id,"/").concat(a.slug,'">Profile</a>\n                                <a class="dropdown-item" href="/').concat(guild.id,"/").concat(guild.slug,"/audit-log?character_id=").concat(a.id,'">History</a>\n                                ').concat(showEdit?'<a class="dropdown-item" href="/'.concat(guild.id,"/").concat(guild.slug,"/c/").concat(a.id,"/").concat(a.slug,'/edit">Edit</a>\n                                    <a class="dropdown-item" href="/').concat(guild.id,"/").concat(guild.slug,"/c/").concat(a.id,"/").concat(a.slug,'/loot">Wishlist & Loot</a>'):"","\n                                ").concat(a.member_id?'<a class="dropdown-item" href="/'.concat(guild.id,"/").concat(guild.slug,"/u/").concat(a.member_id,"/").concat(a.username?a.username.toLowerCase():"view member",'">').concat(a.username?a.username:"view member","</a>"):"","\n                            </div>\n                        </div>\n                        ").concat(getRaidGroupHtml(a.raid_group_name,a.raid_group_color),"\n                    </li>\n                </ul>")},visible:!0,width:"50px",className:"width-50 fixed-width"},{title:"Role",data:"character",render:function render(e,t,a){return'<span class="small text-'.concat(a.class?a.class.toLowerCase():"",'">').concat(a.display_archetype?a.display_archetype:"",'</span>\n                    <br>\n                    <span class="small text-').concat(a.class?a.class.toLowerCase():"",'">').concat(a.display_spec?a.display_spec:"","</span>")},visible:!0,width:"20px",className:"width-20 fixed-width"},{title:"Att.",data:"character",render:function render(e,t,a){return!guild.is_attendance_hidden&&(a.attendance_percentage||a.raid_count||a.benched_count)?'<ul class="list-inline small">\n                            '.concat(a.raid_count&&"number"==typeof a.attendance_percentage?'<li class="list-inline-item mr-0 '.concat(getAttendanceColor(a.attendance_percentage),'" title="attendance">').concat(Math.round(100*a.attendance_percentage),"%</li>"):"","\n                            ").concat(a.raid_count?'<li class="list-inline-item text-muted mr-0">'.concat(a.raid_count,"r</li>"):"","\n                            ").concat(a.benched_count?'<li class="list-inline-item text-muted mr-0">bench '.concat(a.benched_count,"x</li>"):"","\n                        </ul>"):""},visible:!0,width:"10px",className:"width-10 fixed-width"},{title:"Raid",data:"character",render:function render(e,t,a){return a.raid_group_name?(a.secondary_raid_groups&&a.secondary_raid_groups.length&&(secondaryRaidGroups='<ul class="list-inline">',a.secondary_raid_groups.forEach(function(e,t){secondaryRaidGroups+="".concat(e.id,' <li class="list-inline-item small"><span class="text-muted"><span class="role-circle align-fix" style="background-color:').concat(getColorFromDec(parseInt(e.color)),'"></span>').concat(e.name,"</span></li>")}),secondaryRaidGroups+="</ul>"),a.raid_group_id+getRaidGroupHtml(a.raid_group_name,a.raid_group_color)+secondaryRaidGroups):""},visible:!1,width:"50px",className:"width-50 fixed-width"},{title:'<span class="fas fa-fw fa-comment-alt-lines"></span> '.concat(headerNotes),data:"notes",render:function render(e,t,a){return getNotes(e,t,a)},orderable:!1,visible:!1,width:"100px",className:"width-100 fixed-width"},{title:"Class",data:"class",render:function render(e,t,a){return a.class?a.class:null},visible:!1},{title:"Username",data:"username",render:function render(e,t,a){return a.username?a.username:null},visible:!1},{title:"Discord Username",data:"discord_username",render:function render(e,t,a){return a.discord_username?a.discord_username:null},visible:!1},{title:"Raids Attended",data:"raid_count",render:function render(e,t,a){return a.raid_count?a.raid_count:null},visible:!1,searchable:!1},{title:"Benched Count",data:"benched_count",render:function render(e,t,a){return a.benched_count?a.benched_count:null},visible:!1,searchable:!1}];return e.push(getItemColumnBySlot("Head",[SLOT_HEAD]),getItemColumnBySlot("Neck",[SLOT_NECK]),getItemColumnBySlot("Shoulders",[SLOT_SHOULDERS]),getItemColumnBySlot("Back",[SLOT_BACK]),getItemColumnBySlot("Chest",[SLOT_CHEST_1,SLOT_CHEST_2]),getItemColumnBySlot("Wrist",[SLOT_WRIST]),getItemColumnBySlot("Waist",[SLOT_WAIST]),getItemColumnBySlot("Hands",[SLOT_HANDS]),getItemColumnBySlot("Legs",[SLOT_LEGS]),getItemColumnBySlot("Feet",[SLOT_FEET]),getItemColumnBySlot("Finger",[SLOT_FINGER]),getItemColumnBySlot("Trinket",[SLOT_TRINKET]),getItemColumnBySlot("Weapon",[SLOT_WEAPON_MAIN_HAND,SLOT_WEAPON_TWO_HAND,SLOT_WEAPON_ONE_HAND,SLOT_WEAPON_OFF_HAND]),getItemColumnBySlot("Offhand",[SLOT_SHIELD,SLOT_OFFHAND]),getItemColumnBySlot("Ranged /Relic",[SLOT_RANGED_1,SLOT_RANGED_2,SLOT_THROWN,SLOT_RELIC]),getItemColumnBySlot("Misc",[SLOT_MISC,SLOT_SHIRT,SLOT_BAG,SLOT_AMMO])),rosterStatsTable=$("#characterStatsTable").DataTable({autoWidth:!1,data:characters,oLanguage:{sSearch:"<abbr title='Fuzzy searching is ON. To search exact text, wrap your search in \"quotes\"'>Search</abbr>"},columns:e,order:[],paging:!1,fixedHeader:!0,drawCallback:function drawCallback(){callRosterStatHandlers()},initComplete:function initComplete(){var e=[colClass,colArchetype,colMainRaidGroup];this.api().columns().every(function(t){var a=this,n=null,l=null;t==colClass?(n=$("#class_filter"),l=null):t==colArchetype?(n=$("#archetype_filter"),l=null):t==colMainRaidGroup&&(n=$("#raid_group_filter"),l=null),e.includes(t)&&(n.on("change",function(){var e=$.fn.dataTable.util.escapeRegex($(this).val());l&&l.val()&&(_readOnlyError("val"),e="(?=.*"+e+")(?=.*"+$.fn.dataTable.util.escapeRegex(l.val())+")"),a.search(e||"",!0,!1).draw()}).change(),l&&l.on("change",function(){var e=$.fn.dataTable.util.escapeRegex($(this).val());n&&n.val()&&(_readOnlyError("val"),e="(?=.*"+e+")(?=.*"+$.fn.dataTable.util.escapeRegex(n.val())+")"),a.search(e||"",!0,!1).draw()}).change())}),callRosterStatHandlers()}}),rosterStatsTable}function addInstanceFilterHandlers(){$("#instance_filter").change(function(){var e=$("#instance_filter").val();if(e.length){$("li.js-has-instance").hide();var t="";e.forEach(function(e){t+="li.js-has-instance[data-instance-id='"+e+"'],"}),t=t.replace(/(^,)|(,$)/g,""),$(t).show()}else $("li.js-has-instance").show()})}function getItemColumnBySlot(e,t){return{className:"width-50 fixed-width pt-0 pl-0 pb-0 pr-1",title:e,data:"received",render:function render(e,a,n){var l=e.filter(function(e){return t.includes(e.inventory_type)});return l&&l.length?'<span class="font-weight-medium">'.concat(l.length,"</span>\n                    ").concat(getItemListHtml(l,"received",n.id,!1,!1)):'<span class="text-muted">â€”</span>'},orderable:!1,visible:"slots"===view,searchable:!0}}function getItemListHtml(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],c='<ol class="js-item-list list-inline mb-0" data-type="'.concat(t,'" data-id="').concat(a,'" style="').concat(l?"":"display:none;",'">');return $.each(e,function(e,l){var o='data-wowhead-link="https://'.concat(wowheadLocale+wowheadSubdomain,".wowhead.com/item=").concat(l.item_id,'"\n            data-wowhead="item=').concat(l.item_id,"?domain=").concat(wowheadLocale+wowheadSubdomain,'"');c+='\n            <li class="js-has-instance font-weight-normal"\n                data-type="'.concat(t,'"\n                data-id="').concat(a,'"\n                data-offspec="').concat(l.pivot.is_offspec?1:0,'"\n                data-instance-id="').concat(l.instance_id,'"\n                data-wishlist-number="').concat(l.list_number,'"\n                value="').concat(n?l.pivot.order:"",'">\n                ').concat(guild.tier_mode&&l.guild_tier?'<span class="text-monospace font-weight-medium text-tier-'.concat(l.guild_tier?l.guild_tier:"",'">').concat(l.guild_tier?getItemTierLabel(l,guild.tier_mode):"&nbsp;","</span>"):"",'\n                <a href="/').concat(guild.id,"/").concat(guild.slug,"/i/").concat(l.item_id,"/").concat(slug(l.name),'"\n                    class="small ').concat(l.quality?"q"+l.quality:""," ").concat(!l.pivot.is_received||"wishlist"!=l.pivot.type&&"prio"!=l.pivot.type?"":"font-strikethrough",'"\n                    ').concat(o,">\n                    ").concat(l.name,"\n                </a>\n                ").concat(l.pivot.is_offspec?'<span title="offspec item" class="small font-weight-bold text-muted">OS</span>':"",'\n                <span class="js-watchable-timestamp js-timestamp-title smaller text-muted"\n                    data-timestamp="').concat(l.pivot.received_at?l.pivot.received_at:l.pivot.created_at,'"\n                    data-title="added by ').concat(l.added_by_username,' at"\n                    data-is-short="1">\n                </span>\n            </li>')}),c+="</ol>"}function getNotes(e,t,a){return(a.public_note?'<span class="js-markdown-inline small">'.concat(DOMPurify.sanitize(nl2br(a.public_note)),"</span>"):"â€”")+(a.officer_note?'<br><small class="font-weight-medium font-italic text-gold">Officer\'s Note</small><br><span class="js-markdown-inline small">'.concat(DOMPurify.sanitize(nl2br(a.officer_note)),"</span>"):"")}function getRaidGroupHtml(e,t){return e?'<span class="small font-weight-normal d-inline">\n            <span class="role-circle" style="background-color:'.concat(getColorFromDec(parseInt(t)),'"></span>\n                ').concat(e,"\n            </span>"):""}function hideOffspecItems(){$("[data-offspec='1']").hide()}function showOffspecItems(){$("[data-offspec='1']").show()}function callRosterStatHandlers(){rosterHandlersTimeout&&clearTimeout(rosterHandlersTimeout),rosterHandlersTimeout=setTimeout(function(){makeWowheadLinks(),parseMarkdown(),trackTimestamps()},500)}$(document).ready(function(){var e=createRosterStatsTable();$(".toggle-column").click(function(t){t.preventDefault();var a=e.column($(this).attr("data-column"));a.visible(!a.visible())}),$(".toggle-column-default").click(function(t){t.preventDefault(),e.column(colCharacter).visible(!0),e.column(colArchetype).visible(!0),e.column(colSpec).visible(!0),e.column(colAttendance).visible(!0),e.column(colMainRaidGroup).visible(!0),e.column(colSecondaryRaidGroups).visible(!1),e.column(colNotes).visible(!1),e.column(colTotal).visible(!0)}),e.on("column-visibility.dt",function(e,t,a,n){callRosterStatHandlers()}),$(".js-hide-offspec-items").click(function(){offspecVisible?(offspecVisible=!1,hideOffspecItems()):(offspecVisible=!0,showOffspecItems())}),$(".js-show-all-items").click(function(){allItemsVisible?($(".js-item-list").hide(),allItemsVisible=!1):($(".js-item-list").show(),allItemsVisible=!0)}),$(".selectpicker").selectpicker("refresh"),$(".loadingBarContainer").removeClass("d-flex").hide(),$("#characterStatsTable").show(),$("#characterStatsTableFilters").show(),callRosterStatHandlers(),addInstanceFilterHandlers()});
