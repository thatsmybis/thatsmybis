function _readOnlyError(a){throw new Error('"'+a+'" is read-only')}var table=null,colCharacter=1,colRole=2,colSpec=3,colAttendance=4,colMainRaidGroups=5,colSecondaryRaidGroups=6,colNotes=7,colTotal=8,colDungeons=13,offspecVisible=!0,rosterHandlersTimeout=null;function createRosterStatsTable(){$.fn.DataTable.isDataTable("#characterStatsTable")&&$("#characterStatsTable").destroy();var a=[{title:'<span class="fas fa-fw fa-user"></span> '.concat(headerCharacter,' <span class="text-muted small">(').concat(characters.length,")</span>"),data:"character",render:function render(a,e,t){return'<ul class="no-bullet no-indent">\n                    <li>\n                        <div class="dropdown text-'.concat(t.class?t.class.toLowerCase():"",'">\n                            <a class="dropdown-toggle text-4 font-weight-bold text-').concat(t.class?t.class.toLowerCase():"",'"\n                                id="character').concat(t.id,'Dropdown"\n                                role="button"\n                                data-toggle="dropdown"\n                                aria-haspopup="true"\n                                aria-expanded="false"\n                                title="').concat(t.username?t.username:"",'">\n                                ').concat(t.name,'\n                            </a>\n                            <div class="dropdown-menu" aria-labelledby="character').concat(t.id,'Dropdown">\n                                <a class="dropdown-item" href="/').concat(guild.id,"/").concat(guild.slug,"/c/").concat(t.id,"/").concat(t.slug,'">Profile</a>\n                                <a class="dropdown-item" href="/').concat(guild.id,"/").concat(guild.slug,"/audit-log?character_id=").concat(t.id,'">History</a>\n                                ').concat(showEdit?'<a class="dropdown-item" href="/'.concat(guild.id,"/").concat(guild.slug,"/c/").concat(t.id,"/").concat(t.slug,'/edit">Edit</a>\n                                    <a class="dropdown-item" href="/').concat(guild.id,"/").concat(guild.slug,"/c/").concat(t.id,"/").concat(t.slug,'/loot">Wishlist & Loot</a>'):"","\n                                ").concat(t.member_id?'<a class="dropdown-item" href="/'.concat(guild.id,"/").concat(guild.slug,"/u/").concat(t.member_id,"/").concat(t.username?t.username.toLowerCase():"view member",'">').concat(t.username?t.username:"view member","</a>"):"","\n                            </div>\n                        </div>\n                    </li>\n\n                    ").concat(!guild.is_attendance_hidden&&(t.attendance_percentage||t.raid_count||t.benched_count)?'<li>\n                            <ul class="list-inline">\n                            '.concat(t.raid_count&&"number"==typeof t.attendance_percentage?'<li class="list-inline-item '.concat(getAttendanceColor(t.attendance_percentage),'" title="attendance">').concat(Math.round(100*t.attendance_percentage),"%</li>"):"","\n                            ").concat(t.raid_count?'<li class="list-inline-item small text-muted">'.concat(t.raid_count," raid").concat(t.raid_count>1?"s":"","</li>"):"","\n                            ").concat(t.benched_count?'<li class="list-inline-item small text-muted">benched '.concat(t.benched_count,"x</li>"):"","\n                        </li>"):"","\n                </ul>")},visible:!0,width:"250px",className:"width-250"},{title:"Role",data:"character",render:function render(a,e,t){return'<span class="text-'.concat(t.class?t.class.toLowerCase():"",'">').concat(t.archetype?t.archetype:"","</span>")},visible:!0,width:"100px",className:"width-100"},{title:"Spec",data:"character",render:function render(a,e,t){return'<span class="text-'.concat(t.class?t.class.toLowerCase():"",'">').concat(t.spec_label?t.spec_label:t.spec?t.spec:"","</span>")},visible:!0,width:"100px",className:"width-100"},{title:"Raid Group",data:"character",render:function render(a,e,t){return t.raid_group_name?'<span class="font-weight-bold d-inline tag">\n                        <span class="role-circle" style="background-color:'.concat(getColorFromDec(parseInt(t.raid_group_color)),'"></span>\n                        ').concat(t.raid_group_name?t.raid_group_name:"","\n                    </span>"):""},visible:!0,width:"100px",className:"width-100"},{title:'<span class="fas fa-fw fa-comment-alt-lines"></span> '.concat(headerNotes),data:"notes",render:function render(a,e,t){return getNotes(a,e,t)},orderable:!1,visible:!0,width:"200px",className:"width-200"},{title:"Username",data:"username",render:function render(a,e,t){return t.username?t.username:null},visible:!1},{title:"Discord Username",data:"discord_username",render:function render(a,e,t){return t.discord_username?t.discord_username:null},visible:!1},{title:"Raids Attended",data:"raid_count",render:function render(a,e,t){return t.raid_count?t.raid_count:null},visible:!1,searchable:!1},{title:"Benched Count",data:"benched_count",render:function render(a,e,t){return t.benched_count?t.benched_count:null},visible:!1,searchable:!1}];return a.push({title:"Total",data:"all_wishlists",render:function render(a,e,t){return"wishlist stats"},visible:!0,searchable:!0}),instances.forEach(function(e,t){a.push({title:e.short_name,data:"all_wishlists",render:function render(a,e,t){return"wishlist stats"},visible:!0,searchable:!0})}),rosterStatsTable=$("#characterStatsTable").DataTable({autoWidth:!1,data:characters,oLanguage:{sSearch:"<abbr title='Fuzzy searching is ON. To search exact text, wrap your search in \"quotes\"'>Search</abbr>"},columns:a,order:[],paging:!1,fixedHeader:!0,drawCallback:function drawCallback(){callRosterStatHandlers()},initComplete:function initComplete(){var a=[colClass,colRaidGroup];this.api().columns().every(function(e){var t=this,n=null,c=null;e==colClass?(n=$("#class_filter"),c=null):e==colRaidGroup&&(n=$("#raid_group_filter"),c=null),a.includes(e)&&(n.on("change",function(){var a=$.fn.dataTable.util.escapeRegex($(this).val());c&&c.val()&&(_readOnlyError("val"),a="(?=.*"+a+")(?=.*"+$.fn.dataTable.util.escapeRegex(c.val())+")"),t.search(a||"",!0,!1).draw()}).change(),c&&c.on("change",function(){var a=$.fn.dataTable.util.escapeRegex($(this).val());n&&n.val()&&(_readOnlyError("val"),a="(?=.*"+a+")(?=.*"+$.fn.dataTable.util.escapeRegex(n.val())+")"),t.search(a||"",!0,!1).draw()}).change())}),callRosterStatHandlers()}}),rosterStatsTable}function getItemListHtml(a,e,t){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,s='<ol class="no-indent js-item-list mb-2 '.concat(i,'" data-type="').concat(e,'" data-id="').concat(t,'" style="').concat(l?"":"display:none;",'">');o&&(s+='<li class="small text-muted no-bullet " data-type="'.concat(e,'" data-id="').concat(t,'">').concat(o,"</li>"));var r=4,d=null,u=null;return $.each(a,function(i,l){var o=!1;if(i>=4&&(o=!0,4==i&&(s+='<li class="js-show-clipped-items small cursor-pointer no-bullet " data-type="'.concat(e,'" data-id="').concat(t,'">show ').concat(a.length-4," moreâ€¦</li>"))),"prio"==e&&l.pivot.raid_group_id&&l.pivot.raid_group_id!=u){u=l.pivot.raid_group_id;var r="";if(raidGroups.length){var p=raidGroups.find(function(a){return a.id===l.pivot.raid_group_id});p&&(r=p.name)}s+='\n                <li data-raid-group-id="" class="'.concat(o?"js-clipped-item":"",' js-item-wishlist-character no-bullet font-weight-normal font-italic text-muted small"\n                    style="').concat(o?"display:none;":"",'"\n                    data-type="').concat(e,'"\n                    data-id="').concat(t,'">\n                    ').concat(r,"\n                </li>\n            ")}c&&l.instance_id&&l.instance_id!=d&&(d=l.instance_id,s+='\n                <li class="js-has-instance '.concat(o?"js-clipped-item":"",' no-bullet font-weight-normal font-italic text-muted small"\n                    style="').concat(o?"display:none;":"",'"\n                    data-type="').concat(e,'"\n                    data-id="').concat(t,'"\n                    data-instance-id="').concat(l.instance_id,'">\n                    ').concat(l.instance_name,"\n                </li>\n            "));var m='data-wowhead-link="https://'.concat(wowheadLocale+wowheadSubdomain,".wowhead.com/item=").concat(l.item_id,'"\n            data-wowhead="item=').concat(l.item_id,"?domain=").concat(wowheadLocale+wowheadSubdomain,'"');s+='\n            <li class="js-has-instance font-weight-normal '.concat(o?"js-clipped-item":"",'"\n                data-type="').concat(e,'"\n                data-id="').concat(t,'"\n                data-offspec="').concat(l.pivot.is_offspec?1:0,'"\n                data-instance-id="').concat(l.instance_id,'"\n                data-wishlist-number="').concat(l.list_number,'"\n                value="').concat(n?l.pivot.order:"",'"\n                style="').concat(o?"display:none;":"",'">\n                ').concat(guild.tier_mode?'<span class="text-monospace font-weight-medium text-tier-'.concat(l.guild_tier?l.guild_tier:"",'">').concat(l.guild_tier?getItemTierLabel(l,guild.tier_mode):"&nbsp;","</span>"):"",'\n                <a href="/').concat(guild.id,"/").concat(guild.slug,"/i/").concat(l.item_id,"/").concat(slug(l.name),'"\n                    class="').concat(l.quality?"q"+l.quality:""," ").concat(!l.pivot.is_received||"wishlist"!=l.pivot.type&&"prio"!=l.pivot.type?"":"font-strikethrough",'"\n                    ').concat(m,">\n                    ").concat(l.name,"\n                </a>\n                ").concat(l.pivot.is_offspec?'<span title="offspec item" class="small font-weight-bold text-muted">OS</span>':"",'\n                <span class="js-watchable-timestamp js-timestamp-title smaller text-muted"\n                    data-timestamp="').concat(l.pivot.received_at?l.pivot.received_at:l.pivot.created_at,'"\n                    data-title="added by ').concat(l.added_by_username,' at"\n                    data-is-short="1">\n                </span>\n            </li>')}),a.length>4&&(s+='<li class="js-hide-clipped-items small cursor-pointer no-bullet" style="display:none;" data-type="'.concat(e,'" data-id="').concat(t,'">show less</li>')),s+="</ol>"}function getNotes(a,e,t){var n="";return t.secondary_raid_groups&&t.secondary_raid_groups.length&&(n='<ul class="list-inline">',t.secondary_raid_groups.forEach(function(a,e){n+='<li class="list-inline-item small"><span class="tag text-muted"><span class="role-circle align-fix" style="background-color:'.concat(getColorFromDec(parseInt(a.color)),'"></span>').concat(a.name,"</span></li>")}),n+="</ul>"),(t.public_note?'<span class="js-markdown-inline">'.concat(DOMPurify.sanitize(nl2br(t.public_note)),"</span>"):"â€”")+(t.officer_note?'<br><small class="font-weight-bold font-italic text-gold">Officer\'s Note</small><br><span class="js-markdown-inline">'.concat(DOMPurify.sanitize(nl2br(t.officer_note)),"</span>"):"")+(n?"<br>".concat(n):"")}function hideOffspecItems(){$("[data-offspec='1']").hide()}function showOffspecItems(){$("[data-offspec='1']").show()}function callRosterStatHandlers(){rosterHandlersTimeout&&clearTimeout(rosterHandlersTimeout),rosterHandlersTimeout=setTimeout(function(){makeWowheadLinks(),parseMarkdown(),trackTimestamps()},500)}$(document).ready(function(){var a=createRosterStatsTable();$(".toggle-column").click(function(e){e.preventDefault();var t=a.column($(this).attr("data-column"));t.visible(!t.visible())}),$(".toggle-column-default").click(function(e){e.preventDefault(),a.column(colCharacter).visible(!0),a.column(colRole).visible(!0),a.column(colSpec).visible(!0),a.column(colAttendance).visible(!0),a.column(colMainRaidGroup).visible(!0),a.column(colSecondaryRaidGroups).visible(!1),a.column(colNotes).visible(!1),a.column(colTotal).visible(!0)}),a.on("column-visibility.dt",function(a,e,t,n){callRosterStatHandlers()}),$(".js-hide-offspec-items").click(function(){offspecVisible?(offspecVisible=!1,hideOffspecItems()):(offspecVisible=!0,showOffspecItems())}),$(".selectpicker").selectpicker("refresh"),$(".loadingBarContainer").removeClass("d-flex").hide(),$("#characterDatatable").show(),callRosterStatHandlers()});
