function findExistingCharacter(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return a?$('select[name^=characters][name$=\\[character_id\\]] option:selected[value="'.concat(e,'"]')).not(a).first():$('select[name^=characters][name$=\\[character_id\\]] option:selected[value="'.concat(e,'"]')).first()}function fillCharactersFromRaid(e){var a=characters.filter(function(a){return a.raid_group_id==e}),t=characters.filter(function(a){return a.secondary_raid_groups.filter(function(a){return a.id==e}).length>0}),n=a.concat(t).sort(function(e,a){return e.name>a.name?1:a.name>e.name?-1:0}),r=0,s=0,c=!0,i=!1,o=void 0;try{for(var d=n[Symbol.iterator](),l;!(c=(l=d.next()).done);c=!0){var h=l.value,f;if(findExistingCharacter(h.id).length)s++;else{var u=$('select[name^=characters][name$=\\[character_id\\]] option:selected[value=""]').first().parent(),m=u.find('option[value="'+h.id+'"i]');m.val()&&(m.prop("selected",!0).change(),r++);var g=u.parent().closest(".js-row");$(g).find("[name^=characters][name$=\\[is_exempt\\]]").prop("checked",!1).change(),$(g).find("[name^=characters][name$=\\[remark_id\\]]").val("").change(),$(g).find("[name^=characters][name$=\\[credit\\]]").bootstrapSlider("setValue",1)}}}catch(e){i=!0,o=e}finally{try{c||null==d.return||d.return()}finally{if(i)throw o}}$(".js-raid-group-message").html("".concat(r," characters added").concat(s?" (".concat(s," already in list)"):"")).show(),setTimeout(function(){return $(".js-raid-group-message").hide()},7500)}function fixSliderLabels(){window.dispatchEvent(new Event("resize"))}function addWarcraftlogsAttendees(){var e=$("[name^=logs]:visible"),a=[];e.each(function(){$(this).val()&&(log=new URL($(this).val()),log.pathname.split("/").forEach(function(e){16===e.length&&a.push(e)}))}),$(".js-warcraftlogs-attendees-loading-spinner").show(),$("#warcraftlogsLoadingbar").addClass("d-flex").show(),setTimeout(function(){return $("#warcraftlogsLoadingbar").removeClass("d-flex").hide()},7500),$.ajax({method:"get",data:{codes:a,guild_id:guild.id},dataType:"json",url:"/api/warcraftlogs/attendees",success:function success(e){console.log("at success",e),response(e),e.length<=0?error(e):console.log("success?",e)},error:function error(){$(".js-warcraftlogs-attendees-message").html("No attendance data found for that report").show(),setTimeout(function(){return $(".js-warcraftlogs-attendees-message").hide()},7500)},response:function response(){$("#warcraftlogsLoadingbar").removeClass("d-flex").hide()}})}function resetAttendees(){confirm("Are you sure you want to empty and reset the attendee list?")&&($("select[name^=raid_group_id]").val("").change(),$("select[name^=characters][name$=\\[character_id\\]]").val("").change(),$(".js-attendance-skip").prop("checked",!1).change(),$("select[name^=characters][name$=\\[remark_id\\]]").val("").change(),$("[name^=characters][name$=\\[credit\\]]").bootstrapSlider("setValue",1),$("[name^=characters][name$=\\[public_note\\]]").val(""),$("[name^=characters][name$=\\[officer_note\\]]").val(""),$(".js-show-notes").show(),$(".js-notes").hide())}function showNext(e){""!=$(e).val()&&($(e).show(),$(e).parent().next(".js-hide-empty").show())}function showNextCharacter(e){if(""!=$(e).val()){$(e).show();var a=$(e).closest(".js-row").next(".js-hide-empty");a.show(),a.find("select[name^=characters][name$=\\[character_id\\]]").addClass("selectpicker").selectpicker(),fixSliderLabels()}}$(document).ready(function(){var e=!0;warnBeforeLeaving("#editForm"),$.datetimepicker.setLocale(locale||"en"),$(".js-date-input").datetimepicker({format:"Y-m-d H:i:s",inline:!0,step:30,theme:"dark",value:date?moment.utc(date).local().format("YYYY-MM-DD HH:mm:ss"):moment().format("YYYY-MM-DD HH:mm:ss")}),$(".js-date-input").change(),$("[name=raid_group_id\\[\\]]").change(function(){e||$("[name=add_raiders]").prop("checked")&&$(this).val()&&fillCharactersFromRaid($(this).val())}),$("[name^=characters][name$=\\[character_id\\]").change(function(){var a;e||findExistingCharacter($(this).val(),$(this).find(":selected")).length&&$(this).selectpicker("val","").selectpicker("refresh")}),$(".js-show-next").change(function(){showNext(this)}).change(),$(".js-show-next").keyup(function(){showNext(this)}),$(".js-show-next-character").change(function(){showNextCharacter(this)}).change(),$(".js-show-next-character").keyup(function(){showNextCharacter(this)}),$("#addWarcraftlogsAttendees").click(function(){addWarcraftlogsAttendees()}),$(".js-show-notes").click(function(){var e=$(this).data("index");$(this).hide(),$('.js-notes[data-index="'.concat(e,'"]')).show()}),$(".js-attendance-skip").on("change",function(){var e=$(this).data("index");this.checked?($('[data-attendance-input="'.concat(e,'"]')).addClass("disabled").hide(),$('[data-attendance-skip-note="'.concat(e,'"]')).show()):($('[data-attendance-input="'.concat(e,'"]')).removeClass("disabled").show(),$('[data-attendance-skip-note="'.concat(e,'"]')).hide())}).change(),$(".js-clear-attendees").click(function(){resetAttendees()}),e=!1,$(".loadingBarContainer").removeClass("d-flex").hide(),$("#editForm").show(),fixSliderLabels()});
