function addItemAutocompleteHandler(){$(".js-item-autocomplete").each(function(){var t=this;$(this).autocomplete({source:function source(e,n){$.ajax({method:"get",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",url:"/api/items/query/"+expansionId+"/"+e.term+"?locale="+(locale||""),success:function success(a){n(a),a.length<=0&&($(t).nextAll(".js-status-indicator").show(),$(t).nextAll(".js-status-indicator").html('<span class="bg-danger">&nbsp;'+e.term+" not found&nbsp;</span>"))},error:function error(){}})},search:function search(){$(this).nextAll(".js-status-indicator").hide(),$(this).nextAll(".js-status-indicator").empty(),$(this).nextAll(".js-loading-indicator").show()},response:function response(){$(this).nextAll(".js-loading-indicator").hide()},select:function select(t,e){if(e.item.value)return value=e.item.value,label=e.item.label,Number.isInteger(value)&&(addTag(this,value,label),makeWowheadLinks()),!1},minLength:1,delay:400})})}function addItemListSelectHandler(){$(".js-input-item").change(function(){$(this).find(":selected").val(),$(this).find(":selected").html().trim(),value=$(this).find(":selected").val(),label=$(this).find(":selected").html().trim(),$nextInput=$(this).next("ul").children("li").children("input[value='']").first(),""==$nextInput.val()?($nextInput.parent("li").show(),$nextInput.val(value),$nextInput.siblings("input[value='']").first().val(label),$nextInput.siblings(".js-input-label").html(" "+label),$(this).val(""),$(this).find("option:first").text("—")):($(this).val(""),$(this).find("option:first").text("maximum added"))}),$("select.js-input-select").change(function(){var t=$(this).find(":selected").val(),e=$(this).find(":selected").html().trim();if(t){var n=$(this).find(":selected").data("class")||"",a=$(this).data("input-key"),i,l;if($(this).data("no-dupes"))if($(this).parent().next("ol").children("li").find("input".concat(a?'[name$="'.concat(a,'"]'):"",'[value="').concat(t,'"]')).first().length)return void $(this).val("");var s=null;if(a){var d=$(this).data("input-prefix")||null;s=$(this).parent().next("ol").children("li").find("input".concat(d?'[name^="'.concat(d,'"]'):"",'[name$="').concat(a,'"][value=""]')).first()}else s=$(this).parent().next("ol").children("li").find("input[value='']").first();if(""!=s.val()&&(s=$(this).parent().next("ol").children("li[data-needs-template='1']").first()).length){s.html(inputTemplate),s.attr("data-needs-template",0),addItemRemoveHandler();var r=s.data("input-prefix"),u=s.data("index");r&&(s.find("input").each(function(){$(this).attr("name",r+$(this).attr("name"))}),s.find("label").each(function(){$(this).attr("for",r+$(this).attr("for"))})),Number.isInteger(u)&&s.find('input[name$="[order]"]').each(function(){$(this).attr("placeholder",u+1)}),s=s.children("input[value='']").first()}""==s.val()?(s.parent("li").show(),addItemRemoveHandler(),s.parent("li").data("flex")&&s.parent("li").addClass("d-flex"),s.val(t),$displayLabel=s.siblings().find(".js-input-label").first(),$displayLabel.length?$displayLabel.html(" "+e).removeClass(function(t,e){return(e.match(/(^|\s)text-\S+/g)||[]).join(" ")}).addClass(n):s.parent().find(".js-input-label").first().html(" "+e).removeClass(function(t,e){return(e.match(/(^|\s)text-\S+/g)||[]).join(" ")}).addClass(n),$label=s.next("input").first(),$label.val(e),$(this).val(""),s.parent().find('input[name$="[is_offspec]"]').prop("checked",!1),s.parent().find('input[name$="[is_received]"]').prop("checked",!1),s.parent().find('input[name$="[order]"]').val(""),$(this).find("option:first").text("—")):($(this).val(""),$(this).find("option:first").text("maximum added"))}})}function addTagInputHandlers(){$(".js-item-autocomplete").keyup(function(t){keys=[13],$.inArray(t.keyCode,keys)>=0&&(t.preventDefault(),value=this.value,label=value,Number.isInteger(value)&&(addTag(this,value,label),makeWowheadLinks()))}),$(".js-item-autocomplete").focusout(function(){$(this).val()&&(value=this.value,label=value,Number.isInteger(value)&&(addTag(this,value,label),makeWowheadLinks()))})}function addItemRemoveHandler(){$(".js-input-button").click(function(){$(this).unbind(),$(this).prev("input").val(""),$(this).prev("input").prev("input").val(""),$(this).prev("input").prev("input").prev("input").val(""),$(this).parent("li").removeClass("d-flex").hide();var t=$(this).parent("li").parent("ul").siblings(".js-input-select");t.find("option:first").text("—"),t.show();var e=$(this).parent("li").parent("ul").siblings(".js-input-text");e.val()&&e.val().match("^maximum")&&e.val().match("added$")&&e.val(""),e.show()})}function addTag(t,e,n){if(t&&e){if(n||(n=""),$nextInput=$(t).next().next("ul").children("li").children("input:first-child[value='']").first(),""==$nextInput.val()){$nextInput.parent("li").show().addClass("d-flex"),$nextInput.val(e),$nextInput.siblings("input[value='']").first().val(n),$nextInput.parent().find('input[name$="[is_offspec]"]').prop("checked",!1),$nextInput.parent().find('input[name$="[is_received]"]').prop("checked",!1),$nextInput.parent().find('input[name$="[order]"]').val(""),addItemRemoveHandler();var a="";if(guild){var i='data-wowhead-link="https://'.concat(wowheadLocale+wowheadSubdomain,".wowhead.com/item=").concat(e,'"\n                        data-wowhead="item=').concat(e,"?domain=").concat(wowheadLocale+wowheadSubdomain,'"');a=' <a href="/'.concat(guild.id,"/").concat(guild.slug,"/i/").concat(e,"/").concat(slug(n),'"\n                    target="_blank"\n                    class="font-weight-medium"\n                    ').concat(i,">\n                    ").concat(n,"\n                </a>")}else a='<a href="https://'.concat(wowheadLocale+wowheadSubdomain,".wowhead.com/item=").concat(e,'" target="_blank" class="font-weight-medium">').concat(n,"</a>");var l=$nextInput.siblings(".js-input-label"),s=l.children(".js-item-display");return s.length>0?s.html(a):l.html(a),$(t).val(""),$(t).data("isSingleInput")&&$(t).hide(),$(t).change(),!0}return $(t).val("maximum items added"),!1}}$(document).ready(function(){addItemAutocompleteHandler(),addItemListSelectHandler(),addItemRemoveHandler(),addTagInputHandlers()});
