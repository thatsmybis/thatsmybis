function addItemAutocompleteHandler(){$(".js-item-autocomplete").each(function(){var t=this;$(this).autocomplete({source:function source(e,n){$.ajax({method:"get",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",url:"/api/items/query/"+expansionId+"/"+e.term,success:function success(a){n(a),a.length<=0&&($(t).nextAll(".js-status-indicator").show(),$(t).nextAll(".js-status-indicator").html('<span class="bg-danger">&nbsp;'+e.term+" not found&nbsp;</span>"))},error:function error(){}})},search:function search(){$(this).nextAll(".js-status-indicator").hide(),$(this).nextAll(".js-status-indicator").empty(),$(this).nextAll(".js-loading-indicator").show()},response:function response(){$(this).nextAll(".js-loading-indicator").hide()},select:function select(t,e){if(e.item.value)return value=e.item.value,label=e.item.label,Number.isInteger(value)&&(addTag(this,value,label),makeWowheadLinks()),!1},minLength:1,delay:400})})}function addItemListSelectHandler(){$(".js-input-item").change(function(){$(this).find(":selected").val(),$(this).find(":selected").html().trim(),value=$(this).find(":selected").val(),label=$(this).find(":selected").html().trim(),$nextInput=$(this).next("ul").children("li").children("input[value='']").first(),""==$nextInput.val()?($nextInput.parent("li").show(),$nextInput.val(value),$nextInput.siblings("input[value='']").first().val(label),$nextInput.siblings(".js-input-label").html(" "+label),$(this).val(""),$(this).find("option:first").text("—")):($(this).val(""),$(this).find("option:first").text("maximum added"))}),$("select.js-input-select").change(function(){var t=$(this).find(":selected").val(),e=$(this).find(":selected").html().trim(),n=$(this).find(":selected").data("class")||"",a=$(this).data("input-key"),i=null;if(a){var l=$(this).data("input-prefix")||null;i=$(this).parent().next("ol").children("li").find("input".concat(l?'[name^="'.concat(l,'"]'):"",'[name$="').concat(a,'"][value=""]')).first()}else i=$(this).parent().next("ol").children("li").find("input[value='']").first();if(""!=i.val()&&(i=$(this).parent().next("ol").children("li[data-needs-template='1']").first()).length){i.html(inputTemplate),i.attr("data-needs-template",0),addItemRemoveHandler();var s=i.data("input-prefix"),d=i.data("index");s&&(i.find("input").each(function(){$(this).attr("name",s+$(this).attr("name"))}),i.find("label").each(function(){$(this).attr("for",s+$(this).attr("for"))})),d&&i.find('input[name$="[order]"]').each(function(){$(this).attr("placeholder",d+1)}),i=i.children("input[value='']").first()}""==i.val()?(i.parent("li").show(),i.parent("li").data("flex")&&i.parent("li").addClass("d-flex"),i.val(t),i.siblings().find(".js-input-label").first().html(" "+e).removeClass(function(t,e){return(e.match(/(^|\s)text-\S+/g)||[]).join(" ")}).addClass(n),$label=i.next("input").first(),$label.val(e),addItemRemoveHandler(),$(this).val(""),$(this).find("option:first").text("—")):($(this).val(""),$(this).find("option:first").text("maximum added"))})}function addTagInputHandlers(){$(".js-item-autocomplete").keyup(function(t){keys=[13],$.inArray(t.keyCode,keys)>=0&&(t.preventDefault(),value=this.value,label=value,Number.isInteger(value)&&(addTag(this,value,label),makeWowheadLinks()))}),$(".js-item-autocomplete").focusout(function(){$(this).val()&&(value=this.value,label=value,Number.isInteger(value)&&(addTag(this,value,label),makeWowheadLinks()))})}function addItemRemoveHandler(){$(".js-input-button").click(function(){$(this).unbind(),$(this).prev("input").val(""),$(this).prev("input").prev("input").val(""),$(this).prev("input").prev("input").prev("input").val(""),$(this).parent("li").removeClass("d-flex").hide();var t=$(this).parent("li").parent("ul").siblings(".js-input-select");t.find("option:first").text("—"),t.show();var e=$(this).parent("li").parent("ul").siblings(".js-input-text");e.val()&&e.val().match("^maximum")&&e.val().match("added$")&&e.val(""),e.show()})}function addTag(t,e,n){if(t&&e){if(n||(n=""),$nextInput=$(t).next().next("ul").children("li").children("input:first-child[value='']").first(),""==$nextInput.val()){$nextInput.parent("li").show().addClass("d-flex"),$nextInput.val(e),$nextInput.siblings("input[value='']").first().val(n);var a="";if(guild){var i='data-wowhead-link="https://'.concat(wowheadSubdomain,".wowhead.com/item=").concat(e,'"\n                        data-wowhead="item=').concat(e,"?domain=").concat(wowheadSubdomain,'"');a=' <a href="/'.concat(guild.id,"/").concat(guild.slug,"/i/").concat(e,"/").concat(slug(n),'"\n                    target="_blank"\n                    class="font-weight-medium"\n                    ').concat(i,">\n                    ").concat(n,"\n                </a>")}else a='<a href="https://'.concat(wowheadSubdomain,".wowhead.com/item=").concat(e,'" target="_blank" class="font-weight-medium">').concat(n,"</a>");var l=$nextInput.siblings(".js-input-label"),s=l.children(".js-item-display");return s.length>0?s.html(a):l.html(a),$(t).val(""),$(t).data("isSingleInput")&&$(t).hide(),$(t).change(),!0}return $(t).val("maximum items added"),!1}}$(document).ready(function(){addItemAutocompleteHandler(),addItemListSelectHandler(),addItemRemoveHandler(),addTagInputHandlers()});
